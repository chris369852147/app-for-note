<!DOCTYPE html>
<html>
<head>
 <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
 <link href="css/bootstrap.css" rel="stylesheet">
 <script type="text/javascript" src="js/jquery-1.12.2.min.js"></script>
 <script type="text/javascript" src="js/bootstrap.min.js"></script>
	<title></title>
</head>
<body>
 <div class="modal fade" id="mymodal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="data-name"></h4>
      </div>
      <div class="modal-body" id="data">
        <p>One fine body&hellip;</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">關閉</button>
        <button type="button" class="btn btn-primary" id="Change">變更交易內容</button>
      </div>
     </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
   </div><!-- /.modal -->
 <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">新增一筆交易</button><br>
 <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel">交易內容</h4>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="recipient-name" class="control-label">日期/時間:</label>
            <input type="datetime-local" class="form-control" id="date">
          </div>
          <div class="form-group">
            <label for="recipient-name" class="control-label">項目:</label>
            <input type="text" class="form-control" id="subject">
          </div>
          <div class="form-group">
            <label for="recipient-name" class="control-label">金額:</label>
            <input type="text" class="form-control" id="price">
          </div>
          <div class="form-group">
           <label for="recipient-name" class="control-label">付款方式:</label>
           <input class="pay" type="radio" name="pay" value="現金">現金
           <input class="pay" type="radio" name="pay" value="信用卡">信用卡
           <input class="pay" type="radio" name="pay" value="轉帳">轉帳
           <input class="pay" type="radio" name="pay" value="儲值卡">儲值卡
           <input class="pay" type="radio" name="pay" value="電子錢包">電子錢包
          </div>
          <div class="form-group">
            <label for="recipient-name" class="control-label">地點:</label>
            <input type="text" class="form-control" id="place">
          </div>
          <div class="form-group">
            <label for="recipient-name" class="control-label">交易對象:</label>
            <input type="text" class="form-control" id="person">
          </div>
          <div class="form-group">
           <select id="teachers">
            <option>選擇類別</option>
            <option>食品/保健</option>
            <option>服飾/內塑衣/鞋包</option>
            <option>娛樂</option>
            <option>婦幼</option>
            <option>3C/家電</option>
            <option>精品/配飾/美妝</option>
            <option>日用品</option>
            <option>家具/寢飾</option>
            <option>書籍/教育</option>
            <option>運動休閒用品</option>
            <option>交通</option>
            <option>股票/基金/投資</option>
            <option>其它</option>
           </select>
          </div>
          <div class="form-group">
            <label for="messbirthday-text" class="control-label">備註:</label>
            <textarea class="form-control" id="birthday"></textarea>
          </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" id="save">新增</button>
      </div>
    </div>
  </div>
 </div>
 <div class="modal fade" id="set" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  <div class="modal-dialog" role="document">
   <div class="modal-content">
    <div class="modal-header">
     <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <h4 class="modal-title" id="exampleModalLabel">變更交易內容</h4>
     </div>
    <div class="modal-body">
      <form>
        <div class="form-group">
         <label for="recipient-name" class="control-label">日期/時間:</label>
         <input type="datetime-local" class="form-control" id="new-date">
        </div>
        <div class="form-group">
         <label for="recipient-name" class="control-label">項目:</label>
         <input type="text" class="form-control" id="new-subject">
        </div>
        <div class="form-group">
         <label for="recipient-name" class="control-label">金額:</label>
         <input type="text" class="form-control" id="new-price">
        </div>
        <div class="form-group">
           <label for="recipient-name" class="control-label">付款方式:</label>
           <input class="new-pay" type="radio" name="new-pay" value="現金">現金
           <input class="new-pay" type="radio" name="new-pay" value="信用卡">信用卡
           <input class="new-pay" type="radio" name="new-pay" value="轉帳">轉帳
           <input class="new-pay" type="radio" name="new-pay" value="儲值卡">儲值卡
           <input class="new-pay" type="radio" name="new-pay" value="電子錢包">電子錢包
        </div>
        <div class="form-group">
         <label for="recipient-name" class="control-label">地點:</label>
         <input type="text" class="form-control" id="new-place">
        </div>
        <div class="form-group">
         <label for="recipient-name" class="control-label">交易對象:</label>
         <input type="text" class="form-control" id="new-person">
        </div>
        <div class="form-group">
         <select id="new-teachers">
          <option>選擇類別</option>
          <option>食品/保健</option>
          <option>服飾/內塑衣/鞋包</option>
          <option>娛樂</option>
          <option>婦幼</option>
          <option>3C/家電</option>
          <option>精品/配飾/美妝</option>
          <option>日用品</option>
          <option>家具/寢飾</option>
          <option>書籍/教育</option>
          <option>運動休閒用品</option>
          <option>交通</option>
          <option>股票/基金/投資</option>
          <option>其它</option>
         </select>
        </div>
        <div class="form-group">
         <label for="recipient-name" class="control-label">備註:</label>
         <textarea class="form-control" id="new-birthday"></textarea>
        </div>
       </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" id="Delete">刪除交易內容</button>
        <button type="button" class="btn btn-primary" id="changedata">儲存變更</button>
      </div>
   </div>
  </div>
 </div>
<table class="table table-striped">
 <thead>
  <tr>
   <td>日期</td>
   <td>項目</td>
  </tr>
 </thead>
 <tbody id="students">
 </tbody>
</table>
<script type="text/javascript" src="js/fdb-all.min.js"></script>
<script type="text/javascript">
var tr;
var fdb = new ForerunnerDB();
var db = fdb.db("mymoney");
var studentCollection = db.collection('students');
studentCollection.load();
function showModal(){
 tr = $(this)
 var aaa=$(this).attr('data-id')
 var student=studentCollection.find({
   _id:aaa
 })[0];
 console.log(student);
 $("#data-name").text("關於"+student.subject);
 $("#data").html("金額:"+student.price+"<br>"+"付款方式:"+student.pay+"<br>"+"地點:"+student.place+""+"交易對象:"+student.person+"<br>"+"類別:"+student.teacher+"<br>"+"備註:"+student.you);
 $("#mymodal").modal("show");
}
$("#students").on("click","tr",showModal);
setTimeout(function(){
 var students =studentCollection.find();
 for (var i = 0; i < students.length; i++) {
 	var _id = students[i]._id
	var date = students[i].date;
	var subject = students[i].subject;
   	$("#students").append(createString(_id,date,subject))
   	};
},500);
$("#save").click(function(){
 var aaaa={
 	  date:$("#date").val(),
 	  subject:$("#subject").val(),
 	  price:$("#price").val(),
 	  pay:$(".pay").val(),
 	  place:$("#place").val(),
 	  person:$("#person").val(),
 	  teacher:$("#teachers").val(),
 	  you:$("#birthday").val()
 };
 $("#date").val("");
 $("#subject").val("");
 $("#price").val("");
 $(".pay").val("");
 $("#place").val("");
 $("#person").val("");
 $("#teachers").val("選擇類別");
 $("#birthday").val("");
 studentCollection.insert(aaaa);
 studentCollection.save();
 $("#exampleModal").modal('hide');
 var aaa=studentCollection.find(aaaa)[0];
 $("#students").append(createString(aaa._id,aaa.date,aaa.subject));
 });
function createString(_id,date,subject){
	return "<tr data-id='"+_id+"'><td>"+date+"</td><td>"+subject+"</td></tr>"
};
$("#Change").click(function(){
  var _id=$($(tr).find("td")[0]).text();
  var student=studentCollection.find({
  	_id:_id
  })[0];
	$("#set").modal('show');
	$("#new-date").val(student.date);
	$("#subject").val(student.subject);
 	$("#price").val(student.price);
 	$(".pay").val(student.pay);
 	$("#place").val(student.place);
 	$("#person").val(student.person);
	$("#new-teachers").val(student.teacher);
	$("#new-birthday").val(student.you);
});
$("#Delete").click(function(){
	var aaa=$(tr.find("td")[0]).text();
	studentCollection.remove({
		_id:aaa
	});
 studentCollection.save();
 tr.remove();
 $("#set").modal('hide');
 $("#mymodal").modal('hide');
});
$("#changedata").click(function(){
	var _id=$($(tr).find("td")[0]).text();
    studentCollection.update({
 	_id
 },{
 	  date:$("#new-date").val(),
 	  subject:$("#new-subject").val(),
 	  price:$("#new-price").val(),
 	  pay:$(".new-pay").val(),
 	  place:$("#new-place").val(),
 	  person:$("#new-person").val(),
 	  teacher:$("#new-teachers").val(),
 	  you:$("#new-birthday").val()
 	    
 });
    $("#new-date").val("");
    $("#new-subject").val("");
    $("#new-price").val("");
    $(".new-pay").val("");
    $("#new-place").val("");
    $("#new-person").val("");
    $("#new-teachers").val("選擇類別");
    $("#new-birthday").val("");
	studentCollection.save();
	$("#set").modal('hide');
	$("#mymodal").modal('hide');
});
// $("#search").on('click',function(){
// 	if($("#elementary").prop("checked")){
// 		var students=studentCollection.find({
// 			id:{
// 				$gte:60401,
// 				$lte:60432
// 			}
// 		});
// 	}
// 	if($("#junior").prop("checked")){
// 		var students=studentCollection.find({
// 			id:{
// 				$gte:91201,
// 				$lte:91237
// 			}
// 		});
// 	}
// 	console.log(students)
// 	$("#students tr").remove();
// 	for (var i = 0; i < students.length; i++) {
// 		var id = students[i]. id;
// 		var name = students[i].name;
// 		$("#students").append("<tr><td>"+id+"</td><td>"+name+"</td></tr>")
// 	 };
//    });
</script>
</body>
</html>